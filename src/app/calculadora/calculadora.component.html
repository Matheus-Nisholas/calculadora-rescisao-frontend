<div class="calculadora-container">

  <mat-card class="calculator-form-card">
    <mat-card-title>Calcular Rescisão</mat-card-title>
    <mat-card-subtitle>Preencha os dados para simular o cálculo</mat-card-subtitle>
    <mat-card-content>
      <form (ngSubmit)="calcular()" class="calculator-form">
        
        <mat-form-field appearance="outline">
            <mat-label>Nome do Empregado (Opcional)</mat-label>
            <input matInput type="text" [(ngModel)]="calculoRequest.nomeEmpregado" name="nomeEmpregado">
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Tipo de Rescisão</mat-label>
          <mat-select [(ngModel)]="calculoRequest.tipoRescisao" name="tipoRescisao">
            <mat-option value="SEM_JUSTA_CAUSA">Sem Justa Causa</mat-option>
            <mat-option value="JUSTA_CAUSA">Justa Causa</mat-option>
            <mat-option value="PEDIDO_DEMISSAO">Pedido de Demissão</mat-option>
            <mat-option value="ACORDO_484A">Acordo Art. 484-A</mat-option>
            <mat-option value="TERMO_CONTRATO">Término de Contrato</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Salário Mensal</mat-label>
            <span matPrefix>R$&nbsp;</span>
            <input matInput type="number" placeholder="5.000,00" [(ngModel)]="calculoRequest.salarioMensal" name="salarioMensal" required>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Data de Admissão</mat-label>
            <input matInput [matDatepicker]="pickerAdmissao" [(ngModel)]="calculoRequest.dataAdmissao" name="dataAdmissao" required>
            <mat-datepicker-toggle matSuffix [for]="pickerAdmissao"></mat-datepicker-toggle>
            <mat-datepicker #pickerAdmissao></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Data de Desligamento</mat-label>
            <input matInput [matDatepicker]="pickerDesligamento" [(ngModel)]="calculoRequest.dataDesligamento" name="dataDesligamento" required>
            <mat-datepicker-toggle matSuffix [for]="pickerDesligamento"></mat-datepicker-toggle>
            <mat-datepicker #pickerDesligamento></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Saldo FGTS</mat-label>
            <span matPrefix>R$&nbsp;</span>
            <input matInput type="number" placeholder="12.000,00" [(ngModel)]="calculoRequest.saldoFgtsDepositado" name="saldoFgtsDepositado">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Dias de Férias Venc.</mat-label>
            <input matInput type="number" placeholder="0" [(ngModel)]="calculoRequest.feriasVencidasDias" name="feriasVencidasDias">
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Nº de Dependentes (IRRF)</mat-label>
            <input matInput type="number" placeholder="0" [(ngModel)]="calculoRequest.numeroDependentes" name="numeroDependentes">
          </mat-form-field>
        </div>
        
        <mat-checkbox [(ngModel)]="calculoRequest.avisoIndenizado" name="avisoIndenizado" class="checkbox-aviso">
          Houve aviso prévio indenizado?
        </mat-checkbox>

        <div class="form-actions">
          <button mat-stroked-button type="button" (click)="limpar()">Limpar</button>
          <button mat-flat-button color="primary" type="submit">Calcular</button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>

  <div class="results-column">
    <mat-card class="results-card" *ngIf="resultado">
      <mat-card-title>Resultado</mat-card-title>
      <mat-card-content>
        <ul class="breakdown-list">
          <li *ngFor="let comp of resultado.componentes">
            <span>{{ comp.nome }}</span>
            <span class="value">{{ comp.valor | currency:'BRL' }}</span>
          </li>
        </ul>
        <mat-divider></mat-divider>
        <div class="total-line">
          <span>Total Líquido</span>
          <span class="total-value">{{ resultado.totalLiquido | currency:'BRL' }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="history-card">
      <mat-card-title>Últimos Cálculos</mat-card-title>
      <mat-card-content>
        <div *ngIf="ultimosCalculos.length > 0; else noHistory">
          <mat-list>
            <mat-list-item *ngFor="let calc of ultimosCalculos" (click)="navegarParaDetalhes(calc.id)">
              <div matListItemTitle>
                {{ calc.nomeEmpregado || 'N/A' }} ({{ calc.tipoRescisao | titlecase }})
              </div>
              <div matListItemLine>
                {{ calc.totalLiquido | currency:'BRL' }} - {{ calc.criadoEm | date:'short' }}
              </div>
              <mat-divider [inset]="true"></mat-divider>
            </mat-list-item>
          </mat-list>
          <button mat-flat-button color="accent" class="full-history-button" (click)="navegarParaHistoricoCompleto()">
            Ver Histórico Completo
          </button>
        </div>
        <ng-template #noHistory>
          <p class="history-placeholder">Nenhum cálculo recente encontrado.</p>
          <button mat-flat-button color="accent" class="full-history-button" (click)="navegarParaHistoricoCompleto()">
            Ver Histórico Completo
          </button>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>

</div>