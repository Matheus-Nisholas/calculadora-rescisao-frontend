<div class="history-container">
  <h2>Histórico de Cálculos</h2>

  <div class="table-container" [hidden]="isLoading">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

      <ng-container matColumnDef="criadoEm">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data do Cálculo</th>
        <td mat-cell *matCellDef="let item">{{ item.criadoEm | date:'dd/MM/yyyy HH:mm' }}</td>
      </ng-container>

      <ng-container matColumnDef="nomeEmpregado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome do Empregado</th>
        <td mat-cell *matCellDef="let item">{{ item.nomeEmpregado || 'N/A' }}</td>
      </ng-container>
      
      <ng-container matColumnDef="tipoRescisao">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de Rescisão</th>
        <td mat-cell *matCellDef="let item">{{ item.tipoRescisao | titlecase }}</td>
      </ng-container>

      <ng-container matColumnDef="totalLiquido">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor Líquido</th>
        <td mat-cell *matCellDef="let item" class="valor-liquido">{{ item.totalLiquido | currency:'BRL' }}</td>
      </ng-container>
      
      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button color="warn" (click)="excluir(item.id, $event)" matTooltip="Excluir cálculo">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="navigateToDetail(row.id)"></tr>
    </table>

    <div *ngIf="pageData && pageData.totalElements > 0" class="pagination-controls">
      <button mat-stroked-button (click)="previousPage()" [disabled]="pageData.first">Anterior</button>
      <span>Página {{ (pageData.number || 0) + 1 }} de {{ pageData.totalPages || 1 }}</span>
      <button mat-stroked-button (click)="nextPage()" [disabled]="pageData.last">Próxima</button>
    </div>

    <div *ngIf="!isLoading && (!pageData || pageData.totalElements === 0)" class="empty-message">
      Nenhum cálculo encontrado no seu histórico.
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
</div>