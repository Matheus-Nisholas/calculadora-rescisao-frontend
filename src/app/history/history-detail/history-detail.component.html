<div class="detail-container" *ngIf="calculoDetail$ | async as calculo; else loading">
  
  <div class="detail-header">
    <h2>Detalhes do Cálculo</h2>
    
    <div>
      <button mat-flat-button color="primary" (click)="baixarPdf(calculo.id)">
        <mat-icon>download</mat-icon>
        Baixar PDF
      </button>

      <a mat-stroked-button routerLink="/app/historico" class="back-link">
        <mat-icon>arrow_back</mat-icon>
        Voltar
      </a>
    </div>
  </div>

  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>Resumo</mat-card-title>
    </mat-card-header>
    <mat-card-content class="summary-grid">
      <div><strong>Tipo:</strong> {{ calculo.tipoRescisao | titlecase }}</div>
      <div><strong>Admissão:</strong> {{ calculo.dataAdmissao | date:'dd/MM/yyyy' }}</div>
      <div><strong>Salário:</strong> {{ calculo.salarioMensal | currency:'BRL' }}</div>
      <div><strong>Desligamento:</strong> {{ calculo.dataDesligamento | date:'dd/MM/yyyy' }}</div>
    </mat-card-content>
  </mat-card>
  
  <div class="breakdown-grid">
    <mat-card>
      <mat-card-title>Proventos (Verbas Brutas)</mat-card-title>
      <mat-card-content>
        <mat-list>
          <mat-list-item *ngFor="let comp of calculo.componentes">
            <span matListItemTitle>{{ comp.nome }}</span>
            <span matListItemLine class="item-value">{{ comp.valor | currency:'BRL' }}</span>
          </mat-list-item>
        </mat-list>
        <mat-divider></mat-divider>
        <div class="total-line">
          <span><strong>Total Bruto</strong></span>
          <span><strong>{{ calculo.totalBruto | currency:'BRL' }}</strong></span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-title>Descontos</mat-card-title>
      <mat-card-content>
        <div class="desconto-info">
          <p>O detalhamento dos descontos não é salvo no histórico.</p>
        </div>
        <mat-divider></mat-divider>
        <div class="total-line">
          <span><strong>Total Descontos</strong></span>
          <span><strong>{{ calculo.totalDescontos | currency:'BRL' }}</strong></span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="final-total-card">
    <mat-card-title>Valor Líquido a Receber</mat-card-title>
    <p>{{ calculo.totalLiquido | currency:'BRL' }}</p>
    <mat-card-subtitle>Pagamento a ser efetuado até: {{ calculo.pagamentoAte | date:'dd/MM/yyyy' }}</mat-card-subtitle>
  </mat-card>

</div>

<ng-template #loading>
  <div class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
</ng-template>